<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    @import url(https://qwerewqwerew.github.io/source/style/reset.css);
  </style>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
  <style>
    html,
    body {
      position: relative;
      height: 100%;
    }

    section.vh100 {
      width: 100%;
      height: 100vh;
      background: #ccc;
    }

    .swiper {
      width: 100%;
      height: 100%;
    }

    .swiper-slide {
      text-align: center;
      font-size: 18px;
      display: flex;
      justify-content: center;
      align-items: center;
    }
  </style>
</head>

<body>
  <div class="swiper verticals">
    <div class="swiper-wrapper">
      <section class="vh100 swiper-slide"> 1 </section>
      <section class="vh100 swiper-slide"> 2 </section>
      <section class="vh100 swiper-slide"> 3 </section>
      <section class="swiper horizontals swiper-slide">
        <div class="swiper-wrapper">
          <div class="swiper-slide">Slide 1</div>
          <div class="swiper-slide">Slide 2</div>
          <div class="swiper-slide">Slide 3</div>
          <div class="swiper-slide">Slide 4</div>
        </div>
        <div class="swiper-pagination"></div>
      </section>
      <section class="vh100 swiper-slide"> 5 </section>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  <script>
    let vSwiper;   // 세로(Vertical) 슬라이더
    let hSwiper;   // 가로(Horizontal) 슬라이더
    /**
     * 가로슬라이더
     * **/
    hSwiper = new Swiper('.horizontals', {
      direction: 'horizontal',
      slidesPerView: 1,
      spaceBetween: 30,
      mousewheel: true,
      pagination: {
        el: '.swiper-pagination',
        clickable: true,
      },
      on: {
        reachEnd: function () {
          console.log('가로 마지막 슬라이드!');
          hSwiper.canNext = true;
          console.log('✅ canNext 속성 설정됨:', hSwiper.canNext);
        },
        transitionEnd: function () {
          console.log('슬라이드 이동 끝');
          // 마지막에서 오른쪽 이동 시
          if (hSwiper.canNext && hSwiper.isEnd) {
            console.log('세로 이동');
            vSwiper.allowTouchMove = true;
            vSwiper.mousewheel.enable();
            setTimeout(function () {
              vSwiper.slideNext();
              console.log('vSwiper.slideNext() 호출');
            }, 300);
            hSwiper.canNext = false;
          }
          // 첫 번째에서 왼쪽 이동 시 (이전 섹션으로)
          if (hSwiper.canPrev && hSwiper.isBeginning) {
            console.log('이전섹션으로 이동');
            vSwiper.allowTouchMove = true;
            vSwiper.mousewheel.enable();
            setTimeout(function () {
              vSwiper.slideTo(2);
              console.log('3번섹션 호출');
            }, 300);
            hSwiper.canPrev = false;
          }
        }
        , reachBeginning: function () {
          console.log('reachBeginning');
          hSwiper.canPrev = true;
        }
      }
    });

    /**
     * 세로슬라이더
     * **/

    vSwiper = new Swiper('.verticals', {
      direction: 'vertical',
      slidesPerView: 1,
      mousewheel: true,
      on: {
        slideChange: function () {
          //console.log('현재 섹션:', this.activeIndex + 1);
          if (this.activeIndex === 3) {
            vSwiper.allowTouchMove = false;
            vSwiper.mousewheel.disable();
            if (this.previousIndex !== 4) {
              setTimeout(function () {
                hSwiper.slideTo(0, 0);
                console.log('hSwiper.slideTo(0) 호출');
              }, 50);
            } else {
              console.log("5->4");
              vSwiper.allowTouchMove = true;
              vSwiper.mousewheel.enable();
            }
          }
        }
        , slideChangeTransitionStart: function () {
          console.log('세로 이동 시작:', this.previousIndex + 1, '→', this.activeIndex + 1);
          // 5번째에서 4번째(가로)로 이동할 때
          if (this.previousIndex === 4 && this.activeIndex === 3) {
            console.log('세로 5→4, 가로 슬라이더 마지막으로');
            vSwiper.allowTouchMove = false;
            vSwiper.mousewheel.disable();
            setTimeout(function () {
              hSwiper.slideTo(3, 0);
              console.log('세로 hSwiper.slideTo(3) 호출');
            }, 100);
          }
        }
        , slideChangeTransitionEnd: function () {
          if (this.activeIndex === 3) {
            setTimeout(function () {
              if (vSwiper.previousIndex !== 4) {
                hSwiper.update();
                console.log('hSwiper.update()');
              }
            }, 100);
          }
        }
      }
    });
  </script>
</body>

</html>